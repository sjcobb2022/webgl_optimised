<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>WebGL Demo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js"
          integrity="sha512-zhHQR0/H5SEBL3Wn6yYSaTTZej12z0hVZKOv3TwCUXT1z5qeqGcXJLLrbERYRScEDDpYIJhPC1fk31gqR783iQ=="
          crossorigin="anonymous" defer>
  </script>
  <script type="module" src="mygl.js" defer></script>
</head>
<body>

<script type="x-shader/x-vertex" id="vertShader">
  precision highp float;
  attribute vec4 aPosition;
  attribute vec2 aTextureCoord;
  attribute vec3 aNormal;

  uniform mat4 uModelMatrix;
  uniform mat4 uViewMatrix;
  uniform mat4 uProjectionMatrix;
  uniform mat4 uNormalMatrix;

  varying vec2 vTextureCoord;
  varying vec3 vNormal; // same as v_normal
  varying vec3 vSurfaceToLight;
  varying vec3 vPos;

  void main() {

    gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * aPosition;
    vTextureCoord = aTextureCoord;

    vec3 lightWorldPosition = vec3(0.0, 3.0, 0.0);

    vec3 surfaceWorldPosition = (uModelMatrix * aPosition).xyz;

    vSurfaceToLight = lightWorldPosition - surfaceWorldPosition;

    vNormal = vec3(uNormalMatrix * vec4(aNormal, 1.0));

    vPos = vec3(aPosition);

  }

</script>

<script type="x-shader/x-fragment" id="fragShader">
  precision highp float;
  uniform lowp vec4 uColor;

  varying vec3 vNormal;
  varying vec2 vTextureCoord;
  varying vec3 vSurfaceToLight;
  varying vec3 vPos;

  void main() {

    vec3 normal = normalize(vNormal);
    vec3 surfaceToLightDir = normalize(vSurfaceToLight);

    float light = dot(normal, surfaceToLightDir);

    gl_FragColor = uColor;

    light = clamp(light, -0.05, 1.);

    vec3 ambient = vec3(0.2, 0.2, 0.2);

    gl_FragColor.rgb *= (min(ambient + light, 1.0));
  }
</script>


<script type="x-shader/x-vertex" id="pointVert">
  precision highp float;
  attribute vec4 aPosition;
  attribute vec3 aColor;

  uniform mat4 uProjectionMatrix;
  uniform mat4 uViewMatrix;
  uniform mat4 uModelMatrix;

  varying vec3 vColor;

  void main(){
    gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * aPosition;
    gl_PointSize = 20.0;
    vColor = aColor;
  }
</script>
<script type="x-shader/x-fragment" id="pointFrag">
  precision highp float;

  varying vec3 vColor;
  void main(){
    gl_FragColor = vec4(vColor, 1.0);
  }
</script>

<canvas id="glCanvas" width="1920" height="1080" style="width: 75%;"></canvas>
</body>
</html>