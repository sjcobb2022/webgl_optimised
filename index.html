<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>WebGL Demo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js"
          integrity="sha512-zhHQR0/H5SEBL3Wn6yYSaTTZej12z0hVZKOv3TwCUXT1z5qeqGcXJLLrbERYRScEDDpYIJhPC1fk31gqR783iQ=="
          crossorigin="anonymous" defer>
  </script>
  <script type="module" src="mygl.js" defer></script>
</head>
<body>

<script type="x-shader/x-vertex" id="vertShader">
  precision highp float;

  attribute vec4 aPosition;
  attribute vec2 aTextureCoord;
  attribute vec3 aNormal;

  uniform mat4 uModelMatrix;
  uniform mat4 uViewMatrix;
  uniform mat4 uProjectionMatrix;
  uniform mat4 uNormalMatrix;

  varying vec2 vTextureCoord;
  varying highp vec3 vLighting;
  varying vec3 FragPos;



  void main() {

    gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * aPosition;
    vTextureCoord = aTextureCoord;

    FragPos = vec3(aPosition * uModelMatrix);

//    highp vec3 directionalLightColor = vec3(1, 1, 1);
    highp vec3 directionalVector = normalize(vec3(0.85, 0.8, 0.75));
    highp vec4 transformedNormal = uNormalMatrix * vec4(aNormal, 1.0);
//    float distance = length(light.position - FragPos);

//    float attenuation = 1.0 / (light.constant + light.linear * distance + light.quadratic * (distance * distance));

    highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);

    vLighting = vec3(1.0, 1.0, 1.0);

  }
</script>

<script type="x-shader/x-fragment" id="fragShader">
  precision highp float;
  uniform lowp vec4 uColor;
  varying vec3 vLighting;
  varying vec3 FragPos;

  struct Light {
    vec3 position;
    vec3 ambient;

    float constant;
    float linear;
    float quadratic;
  };

  void main() {

    Light light;

    light.ambient = vec3(1.0, 1.0, 1.0);
    light.constant = 1.0;
    light.linear = 0.09;
    light.quadratic = 0.032;
    light.position = vec3(0.0, 0.0, 0.0);

    float distance    = length(light.position - FragPos);

    float attenuation = 1.0 / (light.constant + light.linear * distance +
    light.quadratic * (distance * distance));

    gl_FragColor = uColor * vec4(vLighting * attenuation, 1.0);

  }


</script>

<canvas id="glCanvas" width="640" height="480"></canvas>
</body>
</html>
